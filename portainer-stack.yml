version: '3.8'

services:
  bookarr:
    image: bookarr:latest
    container_name: bookarr
    ports:
      - "2665:2665"
    environment:
      # Database
      - DATABASE_URL=mongodb://mongodb:27017/bookarr
      
      # NextAuth (NEXTAUTH_SECRET will be auto-generated if not provided)
      - NEXTAUTH_URL=http://localhost:2665
      
      # API Keys are configured in the app settings, not as environment variables
      
      # Optional: Download Clients
      - SABNZBD_URL=http://sabnzbd:8080
      - SABNZBD_API_KEY=
      - NZBGET_URL=http://nzbget:6789
      - NZBGET_USERNAME=nzbget
      - NZBGET_PASSWORD=
      
      # Optional: NZB Indexers
      - NZBGEEK_API_KEY=
      - NZBHYDRA_URL=http://nzbhydra:5076
      - NZBHYDRA_API_KEY=
      
      # File Management
      - BOOKS_LIBRARY_PATH=/app/data/books
      - DOWNLOADS_PATH=/app/data/downloads
      - TEMP_PATH=/tmp/bookarr
      
      # Application Settings
      - APP_NAME=Bookarr
      - DEFAULT_LANGUAGE=en
      - DEFAULT_TIMEZONE=UTC
      
      # Features
      - ENABLE_API_KEYS=true
      - ENABLE_DOWNLOADS=true
    volumes:
      - bookarr_data:/app/data
      - bookarr_temp:/tmp/bookarr
    depends_on:
      - mongodb
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:2665/api/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

  mongodb:
    image: mongo:7
    container_name: bookarr-mongodb
    ports:
      - "27017:27017"
    environment:
      - MONGO_INITDB_DATABASE=bookarr
    volumes:
      - mongodb_data:/data/db
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "mongosh", "--eval", "db.adminCommand('ping')"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

volumes:
  bookarr_data:
  bookarr_temp:
  mongodb_data:
